<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Cluster to reduce the clutter | Leaflet in Practice: Create webmaps using the JavaScript Leaflet library</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Cluster to reduce the clutter | Leaflet in Practice: Create webmaps using the JavaScript Leaflet library" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Cluster to reduce the clutter | Leaflet in Practice: Create webmaps using the JavaScript Leaflet library" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Samuel Gachuhi Ngugi" />


<meta name="date" content="2023-07-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="heatmaps.html"/>
<link rel="next" href="mobile-friendly-webapps.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#usage"><i class="fa fa-check"></i>Usage</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-author"><i class="fa fa-check"></i>About the Author</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#copyright"><i class="fa fa-check"></i>Copyright</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-leaflet"><i class="fa fa-check"></i><b>1.1</b> What is Leaflet?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#how-does-it-work"><i class="fa fa-check"></i><b>1.2</b> How does it work?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#javascript"><i class="fa fa-check"></i><b>1.3</b> JavaScript</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#css-files"><i class="fa fa-check"></i><b>1.4</b> CSS files</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#summary"><i class="fa fa-check"></i><b>1.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="first-leaflet-map.html"><a href="first-leaflet-map.html"><i class="fa fa-check"></i><b>2</b> First Leaflet Map</a>
<ul>
<li class="chapter" data-level="2.1" data-path="first-leaflet-map.html"><a href="first-leaflet-map.html#setting-the-superstructure"><i class="fa fa-check"></i><b>2.1</b> Setting the superstructure</a></li>
<li class="chapter" data-level="2.2" data-path="first-leaflet-map.html"><a href="first-leaflet-map.html#beautifying-the-house"><i class="fa fa-check"></i><b>2.2</b> Beautifying the house</a></li>
<li class="chapter" data-level="2.3" data-path="first-leaflet-map.html"><a href="first-leaflet-map.html#summary-1"><i class="fa fa-check"></i><b>2.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="add-ons.html"><a href="add-ons.html"><i class="fa fa-check"></i><b>3</b> Add ons</a>
<ul>
<li class="chapter" data-level="3.1" data-path="add-ons.html"><a href="add-ons.html#not-just-a-plain-map"><i class="fa fa-check"></i><b>3.1</b> Not just a plain map</a></li>
<li class="chapter" data-level="3.2" data-path="add-ons.html"><a href="add-ons.html#a-marker"><i class="fa fa-check"></i><b>3.2</b> A marker</a></li>
<li class="chapter" data-level="3.3" data-path="add-ons.html"><a href="add-ons.html#a-marker-with-a-popup"><i class="fa fa-check"></i><b>3.3</b> A marker with a popup</a></li>
<li class="chapter" data-level="3.4" data-path="add-ons.html"><a href="add-ons.html#different-markers-and-popups"><i class="fa fa-check"></i><b>3.4</b> Different markers and popups</a></li>
<li class="chapter" data-level="3.5" data-path="add-ons.html"><a href="add-ons.html#summary-2"><i class="fa fa-check"></i><b>3.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="embedding-leaflet-map-to-an-external-website.html"><a href="embedding-leaflet-map-to-an-external-website.html"><i class="fa fa-check"></i><b>4</b> Embedding leaflet map to an external website</a>
<ul>
<li class="chapter" data-level="4.1" data-path="embedding-leaflet-map-to-an-external-website.html"><a href="embedding-leaflet-map-to-an-external-website.html#a-website-with-a-sense-of-direction"><i class="fa fa-check"></i><b>4.1</b> A website with a sense of direction</a></li>
<li class="chapter" data-level="4.2" data-path="embedding-leaflet-map-to-an-external-website.html"><a href="embedding-leaflet-map-to-an-external-website.html#the-html-webpage"><i class="fa fa-check"></i><b>4.2</b> The HTML webpage</a></li>
<li class="chapter" data-level="4.3" data-path="embedding-leaflet-map-to-an-external-website.html"><a href="embedding-leaflet-map-to-an-external-website.html#a-simple-for-loop-for-webmap-display"><i class="fa fa-check"></i><b>4.3</b> A simple <code>for</code> loop for webmap display</a></li>
<li class="chapter" data-level="4.4" data-path="embedding-leaflet-map-to-an-external-website.html"><a href="embedding-leaflet-map-to-an-external-website.html#summary-3"><i class="fa fa-check"></i><b>4.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="using-geojson-in-leaflet.html"><a href="using-geojson-in-leaflet.html"><i class="fa fa-check"></i><b>5</b> Using GeoJSON in Leaflet</a>
<ul>
<li class="chapter" data-level="5.1" data-path="using-geojson-in-leaflet.html"><a href="using-geojson-in-leaflet.html#creating-a-.geojson-file"><i class="fa fa-check"></i><b>5.1</b> Creating a <code>.geojson</code> file</a></li>
<li class="chapter" data-level="5.2" data-path="using-geojson-in-leaflet.html"><a href="using-geojson-in-leaflet.html#what-are-.geojson-files"><i class="fa fa-check"></i><b>5.2</b> What are <code>.geojson</code> files?</a></li>
<li class="chapter" data-level="5.3" data-path="using-geojson-in-leaflet.html"><a href="using-geojson-in-leaflet.html#why-geojson"><i class="fa fa-check"></i><b>5.3</b> Why <code>geojson</code>?</a></li>
<li class="chapter" data-level="5.4" data-path="using-geojson-in-leaflet.html"><a href="using-geojson-in-leaflet.html#creating-a-geojson-file"><i class="fa fa-check"></i><b>5.4</b> Creating a geojson file</a></li>
<li class="chapter" data-level="5.5" data-path="using-geojson-in-leaflet.html"><a href="using-geojson-in-leaflet.html#saving-the-geojson-to-github"><i class="fa fa-check"></i><b>5.5</b> Saving the Geojson to Github</a></li>
<li class="chapter" data-level="5.6" data-path="using-geojson-in-leaflet.html"><a href="using-geojson-in-leaflet.html#loading-the-geojson-into-leaflet"><i class="fa fa-check"></i><b>5.6</b> Loading the GeoJSON into Leaflet</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="using-geojson-in-leaflet.html"><a href="using-geojson-in-leaflet.html#the-easy-way"><i class="fa fa-check"></i><b>5.6.1</b> The easy way</a></li>
<li class="chapter" data-level="5.6.2" data-path="using-geojson-in-leaflet.html"><a href="using-geojson-in-leaflet.html#using-the-ajax-plugin"><i class="fa fa-check"></i><b>5.6.2</b> Using the Ajax Plugin</a></li>
<li class="chapter" data-level="5.6.3" data-path="using-geojson-in-leaflet.html"><a href="using-geojson-in-leaflet.html#using-fetch-api"><i class="fa fa-check"></i><b>5.6.3</b> Using Fetch API</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="using-geojson-in-leaflet.html"><a href="using-geojson-in-leaflet.html#summary-4"><i class="fa fa-check"></i><b>5.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="create-your-own-custom-markers.html"><a href="create-your-own-custom-markers.html"><i class="fa fa-check"></i><b>6</b> Create your own custom markers</a>
<ul>
<li class="chapter" data-level="6.1" data-path="create-your-own-custom-markers.html"><a href="create-your-own-custom-markers.html#setting-the-base"><i class="fa fa-check"></i><b>6.1</b> Setting the base</a></li>
<li class="chapter" data-level="6.2" data-path="create-your-own-custom-markers.html"><a href="create-your-own-custom-markers.html#the-icons"><i class="fa fa-check"></i><b>6.2</b> The icons</a></li>
<li class="chapter" data-level="6.3" data-path="create-your-own-custom-markers.html"><a href="create-your-own-custom-markers.html#differentiate-custom-markers-on-a-webmap"><i class="fa fa-check"></i><b>6.3</b> Differentiate custom markers on a webmap</a></li>
<li class="chapter" data-level="6.4" data-path="create-your-own-custom-markers.html"><a href="create-your-own-custom-markers.html#using-fetch"><i class="fa fa-check"></i><b>6.4</b> Using fetch</a></li>
<li class="chapter" data-level="6.5" data-path="create-your-own-custom-markers.html"><a href="create-your-own-custom-markers.html#unique-custom-markers"><i class="fa fa-check"></i><b>6.5</b> Unique custom markers</a></li>
<li class="chapter" data-level="6.6" data-path="create-your-own-custom-markers.html"><a href="create-your-own-custom-markers.html#image-overlays"><i class="fa fa-check"></i><b>6.6</b> Image overlays</a></li>
<li class="chapter" data-level="6.7" data-path="create-your-own-custom-markers.html"><a href="create-your-own-custom-markers.html#summary-5"><i class="fa fa-check"></i><b>6.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="creating-an-interactive-choropleth-map.html"><a href="creating-an-interactive-choropleth-map.html"><i class="fa fa-check"></i><b>7</b> Creating an interactive choropleth map</a>
<ul>
<li class="chapter" data-level="7.1" data-path="creating-an-interactive-choropleth-map.html"><a href="creating-an-interactive-choropleth-map.html#what-is-a-choropleth-map"><i class="fa fa-check"></i><b>7.1</b> What is a choropleth map?</a></li>
<li class="chapter" data-level="7.2" data-path="creating-an-interactive-choropleth-map.html"><a href="creating-an-interactive-choropleth-map.html#creating-a-choropleth-map-the-start"><i class="fa fa-check"></i><b>7.2</b> Creating a choropleth map: the start</a></li>
<li class="chapter" data-level="7.3" data-path="creating-an-interactive-choropleth-map.html"><a href="creating-an-interactive-choropleth-map.html#coloring-the-counties"><i class="fa fa-check"></i><b>7.3</b> Coloring the counties</a></li>
<li class="chapter" data-level="7.4" data-path="creating-an-interactive-choropleth-map.html"><a href="creating-an-interactive-choropleth-map.html#highlight-features"><i class="fa fa-check"></i><b>7.4</b> Highlight features</a></li>
<li class="chapter" data-level="7.5" data-path="creating-an-interactive-choropleth-map.html"><a href="creating-an-interactive-choropleth-map.html#creating-a-custom-info"><i class="fa fa-check"></i><b>7.5</b> Creating a custom info</a></li>
<li class="chapter" data-level="7.6" data-path="creating-an-interactive-choropleth-map.html"><a href="creating-an-interactive-choropleth-map.html#create-a-legend"><i class="fa fa-check"></i><b>7.6</b> Create a legend</a></li>
<li class="chapter" data-level="7.7" data-path="creating-an-interactive-choropleth-map.html"><a href="creating-an-interactive-choropleth-map.html#summary-6"><i class="fa fa-check"></i><b>7.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="layer-groups-and-controls.html"><a href="layer-groups-and-controls.html"><i class="fa fa-check"></i><b>8</b> Layer groups and controls</a>
<ul>
<li class="chapter" data-level="8.1" data-path="layer-groups-and-controls.html"><a href="layer-groups-and-controls.html#purpose-of-layer-groups-and-controls"><i class="fa fa-check"></i><b>8.1</b> Purpose of layer groups and controls</a></li>
<li class="chapter" data-level="8.2" data-path="layer-groups-and-controls.html"><a href="layer-groups-and-controls.html#set-up-the-basemaps"><i class="fa fa-check"></i><b>8.2</b> Set up the basemaps</a></li>
<li class="chapter" data-level="8.3" data-path="layer-groups-and-controls.html"><a href="layer-groups-and-controls.html#creating-the-controls"><i class="fa fa-check"></i><b>8.3</b> Creating the controls</a></li>
<li class="chapter" data-level="8.4" data-path="layer-groups-and-controls.html"><a href="layer-groups-and-controls.html#adding-overlay-maps"><i class="fa fa-check"></i><b>8.4</b> Adding overlay maps</a></li>
<li class="chapter" data-level="8.5" data-path="layer-groups-and-controls.html"><a href="layer-groups-and-controls.html#add-a-scale-bar"><i class="fa fa-check"></i><b>8.5</b> Add a scale bar</a></li>
<li class="chapter" data-level="8.6" data-path="layer-groups-and-controls.html"><a href="layer-groups-and-controls.html#summary-7"><i class="fa fa-check"></i><b>8.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="heatmaps.html"><a href="heatmaps.html"><i class="fa fa-check"></i><b>9</b> Heatmaps</a>
<ul>
<li class="chapter" data-level="9.1" data-path="heatmaps.html"><a href="heatmaps.html#what-are-heatmaps"><i class="fa fa-check"></i><b>9.1</b> What are heatmaps?</a></li>
<li class="chapter" data-level="9.2" data-path="heatmaps.html"><a href="heatmaps.html#loading-the-heatmap-plugin"><i class="fa fa-check"></i><b>9.2</b> Loading the heatmap plugin</a></li>
<li class="chapter" data-level="9.3" data-path="heatmaps.html"><a href="heatmaps.html#creating-the-leaflet-heatmap"><i class="fa fa-check"></i><b>9.3</b> Creating the Leaflet heatmap</a></li>
<li class="chapter" data-level="9.4" data-path="heatmaps.html"><a href="heatmaps.html#summary-8"><i class="fa fa-check"></i><b>9.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="cluster-to-reduce-the-clutter.html"><a href="cluster-to-reduce-the-clutter.html"><i class="fa fa-check"></i><b>10</b> Cluster to reduce the clutter</a>
<ul>
<li class="chapter" data-level="10.1" data-path="cluster-to-reduce-the-clutter.html"><a href="cluster-to-reduce-the-clutter.html#a-map-full-of-clutter"><i class="fa fa-check"></i><b>10.1</b> A map full of clutter</a></li>
<li class="chapter" data-level="10.2" data-path="cluster-to-reduce-the-clutter.html"><a href="cluster-to-reduce-the-clutter.html#preparations"><i class="fa fa-check"></i><b>10.2</b> Preparations</a></li>
<li class="chapter" data-level="10.3" data-path="cluster-to-reduce-the-clutter.html"><a href="cluster-to-reduce-the-clutter.html#behold-a-cluster-marker-map"><i class="fa fa-check"></i><b>10.3</b> Behold, a cluster marker map!</a></li>
<li class="chapter" data-level="10.4" data-path="cluster-to-reduce-the-clutter.html"><a href="cluster-to-reduce-the-clutter.html#additional-features-of-cluster-marker-plugin"><i class="fa fa-check"></i><b>10.4</b> Additional features of Cluster marker plugin</a></li>
<li class="chapter" data-level="10.5" data-path="cluster-to-reduce-the-clutter.html"><a href="cluster-to-reduce-the-clutter.html#summary-9"><i class="fa fa-check"></i><b>10.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="mobile-friendly-webapps.html"><a href="mobile-friendly-webapps.html"><i class="fa fa-check"></i><b>11</b> Mobile Friendly Webapps</a>
<ul>
<li class="chapter" data-level="11.1" data-path="mobile-friendly-webapps.html"><a href="mobile-friendly-webapps.html#the-need-for-mobile-friendly-web-apps"><i class="fa fa-check"></i><b>11.1</b> The need for mobile friendly web apps</a></li>
<li class="chapter" data-level="11.2" data-path="mobile-friendly-webapps.html"><a href="mobile-friendly-webapps.html#the-basemaps"><i class="fa fa-check"></i><b>11.2</b> The basemaps</a></li>
<li class="chapter" data-level="11.3" data-path="mobile-friendly-webapps.html"><a href="mobile-friendly-webapps.html#adding-the-features"><i class="fa fa-check"></i><b>11.3</b> Adding the features</a></li>
<li class="chapter" data-level="11.4" data-path="mobile-friendly-webapps.html"><a href="mobile-friendly-webapps.html#zooming-to-mobile-users-location"><i class="fa fa-check"></i><b>11.4</b> Zooming to mobile user’s location</a></li>
<li class="chapter" data-level="11.5" data-path="mobile-friendly-webapps.html"><a href="mobile-friendly-webapps.html#add-marker-to-mobile-users-geolocation"><i class="fa fa-check"></i><b>11.5</b> Add marker to mobile user’s geolocation</a></li>
<li class="chapter" data-level="11.6" data-path="mobile-friendly-webapps.html"><a href="mobile-friendly-webapps.html#the-mobile-webmap-app-in-action"><i class="fa fa-check"></i><b>11.6</b> The mobile webmap app in action!</a></li>
<li class="chapter" data-level="11.7" data-path="mobile-friendly-webapps.html"><a href="mobile-friendly-webapps.html#summary-10"><i class="fa fa-check"></i><b>11.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="web-map-service-layers.html"><a href="web-map-service-layers.html"><i class="fa fa-check"></i><b>12</b> Web Map Service Layers</a>
<ul>
<li class="chapter" data-level="12.1" data-path="web-map-service-layers.html"><a href="web-map-service-layers.html#what-are-web-map-service-wms-layers"><i class="fa fa-check"></i><b>12.1</b> What are Web Map Service (WMS) Layers?</a></li>
<li class="chapter" data-level="12.2" data-path="web-map-service-layers.html"><a href="web-map-service-layers.html#loading-a-wms-server"><i class="fa fa-check"></i><b>12.2</b> Loading a WMS server</a></li>
<li class="chapter" data-level="12.3" data-path="web-map-service-layers.html"><a href="web-map-service-layers.html#adding-wms-to-layer-control"><i class="fa fa-check"></i><b>12.3</b> Adding WMS to layer control</a></li>
<li class="chapter" data-level="12.4" data-path="web-map-service-layers.html"><a href="web-map-service-layers.html#summary-11"><i class="fa fa-check"></i><b>12.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="standard-website-with-leaflet-project.html"><a href="standard-website-with-leaflet-project.html"><i class="fa fa-check"></i><b>13</b> Standard Website with Leaflet Project</a>
<ul>
<li class="chapter" data-level="13.1" data-path="standard-website-with-leaflet-project.html"><a href="standard-website-with-leaflet-project.html#get-the-html-template"><i class="fa fa-check"></i><b>13.1</b> Get the HTML Template</a></li>
<li class="chapter" data-level="13.2" data-path="standard-website-with-leaflet-project.html"><a href="standard-website-with-leaflet-project.html#embed-leaflet-to-standard-html-website"><i class="fa fa-check"></i><b>13.2</b> Embed Leaflet to standard html website</a></li>
<li class="chapter" data-level="13.3" data-path="standard-website-with-leaflet-project.html"><a href="standard-website-with-leaflet-project.html#editing-the-css"><i class="fa fa-check"></i><b>13.3</b> Editing the CSS</a></li>
<li class="chapter" data-level="13.4" data-path="standard-website-with-leaflet-project.html"><a href="standard-website-with-leaflet-project.html#embedding-leaflet-to-every-webpage"><i class="fa fa-check"></i><b>13.4</b> Embedding Leaflet to every webpage</a></li>
<li class="chapter" data-level="13.5" data-path="standard-website-with-leaflet-project.html"><a href="standard-website-with-leaflet-project.html#posting-the-html-website-to-the-world"><i class="fa fa-check"></i><b>13.5</b> Posting the Html website to the world</a></li>
<li class="chapter" data-level="13.6" data-path="standard-website-with-leaflet-project.html"><a href="standard-website-with-leaflet-project.html#summary-12"><i class="fa fa-check"></i><b>13.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="esri-and-leaflet.html"><a href="esri-and-leaflet.html"><i class="fa fa-check"></i><b>14</b> ESRI and Leaflet</a>
<ul>
<li class="chapter" data-level="14.1" data-path="esri-and-leaflet.html"><a href="esri-and-leaflet.html#an-overview-of-esri"><i class="fa fa-check"></i><b>14.1</b> An overview of ESRI</a></li>
<li class="chapter" data-level="14.2" data-path="esri-and-leaflet.html"><a href="esri-and-leaflet.html#esri-leaflet-plugins"><i class="fa fa-check"></i><b>14.2</b> ESRI Leaflet plugins</a></li>
<li class="chapter" data-level="14.3" data-path="esri-and-leaflet.html"><a href="esri-and-leaflet.html#creating-an-esri-leaflet-map"><i class="fa fa-check"></i><b>14.3</b> Creating an ESRI Leaflet map</a></li>
<li class="chapter" data-level="14.4" data-path="esri-and-leaflet.html"><a href="esri-and-leaflet.html#geocode-search"><i class="fa fa-check"></i><b>14.4</b> Geocode search</a></li>
<li class="chapter" data-level="14.5" data-path="esri-and-leaflet.html"><a href="esri-and-leaflet.html#add-search-bar"><i class="fa fa-check"></i><b>14.5</b> Add search bar</a></li>
<li class="chapter" data-level="14.6" data-path="esri-and-leaflet.html"><a href="esri-and-leaflet.html#make-the-search-bar-functional"><i class="fa fa-check"></i><b>14.6</b> Make the search bar functional</a></li>
<li class="chapter" data-level="14.7" data-path="esri-and-leaflet.html"><a href="esri-and-leaflet.html#adding-an-auto-generated-location-pin"><i class="fa fa-check"></i><b>14.7</b> Adding an auto-generated location pin</a></li>
<li class="chapter" data-level="14.8" data-path="esri-and-leaflet.html"><a href="esri-and-leaflet.html#summary-13"><i class="fa fa-check"></i><b>14.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>15</b> Conclusion</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Leaflet in Practice: Create webmaps using the JavaScript Leaflet library</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cluster-to-reduce-the-clutter" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Chapter 10</span> Cluster to reduce the clutter<a href="cluster-to-reduce-the-clutter.html#cluster-to-reduce-the-clutter" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="a-map-full-of-clutter" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> A map full of clutter<a href="cluster-to-reduce-the-clutter.html#a-map-full-of-clutter" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There comes a time when it is convenient to coalesce several points into a single multi-cluster point. Consider the following example: you have a GeoJSON file with over 10000 points of houses within a densely populated island of 5km by 5km, if by any chance such a scenario exists. Will you want to display such a gigantic number of points within such a small area? That would be an overkill! Moreover, it will be incomprehensible to the viewer. Consider the following example we set up in a new JavaScript file which we fondly called <code>cluster-markers.js</code>.</p>
<pre><code>var map = L.map(&#39;myMap&#39;).setView([-1.295287148, 36.81984753], 7);

L.tileLayer(&#39;https://tile.openstreetmap.org/{z}/{x}/{y}.png&#39;, {
    maxZoom: 19,
    attribution: &#39;&amp;copy; &lt;a href=&quot;http://www.openstreetmap.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt;&#39;
}).addTo(map);


url = &#39;https://raw.githubusercontent.com/sammigachuhi/geojson_files/main/selected_hospitals.json&#39;

L.geoJson.ajax(url).addTo(map);

var markers = L.markerClusterGroup();
</code></pre>
<p>The following is the result.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="cluster-to-reduce-the-clutter.html#cb135-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="fu">rep</span>(<span class="st">&#39;D:/gachuhi/my-leaflet/images/clutter-points.jpg&#39;</span>))</span></code></pre></div>
<p><img src="../images/clutter-points.jpg" width="514" /></p>
<p>Not good at all. The <code>Leaflet.markercluster</code> plugin is what transforms a clutter map into one of neatly arranged clustered marker points.</p>
</div>
<div id="preparations" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Preparations<a href="cluster-to-reduce-the-clutter.html#preparations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Creating a cluster marker map is fairly easy. You will first have to insert the <code>Leaflet.markerCluster</code> plugin into <code>map.html</code>. The plugin is available from <a href="https://github.com/Leaflet/Leaflet.markercluster/archive/refs/heads/master.zip">here</a>. Insert the following <code>&lt;script&gt;</code> tag into the <code>&lt;head&gt;</code> element of your <code>map.html</code>.</p>
<pre><code>&lt;script src=&quot;Leaflet.markercluster-1.4.1\Leaflet.markercluster-1.4.1\dist\leaflet.markercluster.js&quot;&gt;&lt;/script&gt;</code></pre>
<p>You will also have to insert the <code>Leaflet.markercluster</code> CSS properties via the <code>&lt;link&gt;</code> tag too. Add the following <code>&lt;link&gt;</code> tag for <code>Leaflet.markercluster</code> after the other <code>&lt;link&gt;</code> properties.</p>
<pre><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;Leaflet.markercluster-master\Leaflet.markercluster-master\dist\MarkerCluster.Default.css&quot;&gt; </code></pre>
<p>Don’t underestimate them. These CSS properties are necessary to style your cluster points in a nice way that’s easy on the eye. It is also assumed you have already inserted the name of your JavaScript file, the <code>cluster-marker.js</code> within the <code>script</code> tag enclosed by the <code>&lt;body&gt;</code> element of your <code>map.html</code> file.</p>
<p>If you had done the small exercise at the beginning of the chapter, the following code should be present.</p>
<pre><code>var map = L.map(&#39;myMap&#39;).setView([-1.295287148, 36.81984753], 7);

L.tileLayer(&#39;https://tile.openstreetmap.org/{z}/{x}/{y}.png&#39;, {
    maxZoom: 19,
    attribution: &#39;&amp;copy; &lt;a href=&quot;http://www.openstreetmap.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt;&#39;
}).addTo(map);


url = &#39;https://raw.githubusercontent.com/sammigachuhi/geojson_files/main/selected_hospitals.json&#39;
</code></pre>
</div>
<div id="behold-a-cluster-marker-map" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Behold, a cluster marker map!<a href="cluster-to-reduce-the-clutter.html#behold-a-cluster-marker-map" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Delete the <code>L.geoJson.ajax(url).addTo(map);</code>, we won’t need it now. Our real work of creating a cluster marker map begins with the <code>markerClusterGroup</code> class. Let’s proceed!</p>
<pre><code>var markers = L.markerClusterGroup();
</code></pre>
<p>We shall use Ajax again but this time round we shall parse in some functions to customize the appearance and functionalities of our GeoJson markers.</p>
<pre><code>
L.geoJson.ajax(url, {
    pointToLayer: ((feature, latLng) =&gt; {
        return markers.addLayer(L.circleMarker(latLng));
    }),

    onEachFeature: ((feature, layer) =&gt; {
        layer.bindPopup(`&lt;b&gt;Facility Name:&lt;/b&gt; ${feature.properties.Facility_N} &lt;br&gt;
        &lt;b&gt;Type:&lt;/b&gt; ${feature.properties.Type}`)
    })
}).addTo(map);</code></pre>
<p>Remember <code>pointToLayer</code> of Leaflet GeoJSON files? It defines how the GeoJson file will appear. The <code>pointToLayer</code> retrieves the Latitude-Longitude coordinates before finally creating circle markers out of them as enabled by <code>...return markers.addLayer(L.circleMarker(latLng))</code>,</p>
<p>How about for <code>onEachFeature</code>? You can guess. It simply means– <em>O</em>n <em>E</em>ach <em>F</em>eature, <em>do this and that</em>. In our case we bind a popup of facility name and type which will appear when a circle marker is clicked on.</p>
<p>Actually, the above code sort of finished the work for us.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="cluster-to-reduce-the-clutter.html#cb141-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="fu">rep</span>(<span class="st">&#39;D:/gachuhi/my-leaflet/images/cluster-marker-map.jpg&#39;</span>))</span></code></pre></div>
<p><img src="../images/cluster-marker-map.jpg" width="960" /></p>
<p>Zoom in and out and watch the circle markers <em>spidefy</em> the individual points with a popup. I have restrained from tweaking the markers because the defaults are already good enough. See them from this <a href="https://github.com/Leaflet/Leaflet.markercluster">Github Page</a>.</p>
<p>However, as good practice, we need to add the <code>markers</code> global variable to the map. We do so by using the following code.</p>
<pre><code>map.addLayer(markers)
</code></pre>
<p><code>addLayers</code>, just like the name suggests, adds the given layer to the map.</p>
<p>The <code>L.circleMarker</code> in the <code>pointToLayer</code> key of the Ajax function can be replaced with <code>L.marker()</code>. Below is how some spiderfied hospital markers look like, and they are far from being aesthetically pleasing.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="cluster-to-reduce-the-clutter.html#cb143-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="fu">rep</span>(<span class="st">&#39;D:/gachuhi/my-leaflet/images/cluster-marker-plain.jpg&#39;</span>))</span></code></pre></div>
<p><img src="../images/cluster-marker-plain.jpg" width="906" /></p>
<p>Coming back full circle, circle markers are way better.</p>
<p>Most of the Ajax code was inspired by this <a href="https://www.youtube.com/watch?v=R-V7XFUbrkw&amp;t=625s">video</a>.</p>
<p>But wait! Hold your horses, there is a bug. Try to click on any of the spiderfied or lone hospitals and you will notice something that will raise eyebrows. All hospitals display the following popup when clicked:</p>
<pre><code>Facility Name: Wajir Tb Manyatta Sub - District Hospital
Type: Sub-District Hospital</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="cluster-to-reduce-the-clutter.html#cb145-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="fu">rep</span>(<span class="st">&#39;D:/gachuhi/my-leaflet/images/cluster-marker-bug.jpg&#39;</span>))</span></code></pre></div>
<p><img src="../images/cluster-marker-bug.jpg" width="946" /></p>
<p>Unless a developer would like to be left with an egg on the face for assigning wrong place names, this should be dealt with expeditiously. Our code is alright, since it works in other scenarios such as <a href="https://gis.stackexchange.com/questions/346104/popup-with-leaflet-markercluster-in-leaflet-map?utm_source=pocket_reader">here</a>. However, it is unnacceptable to assign wrong place names in the world wide web. .</p>
<p>Time to try a different strategy: using <code>fetch</code> API. We have worked with <code>fetch</code> before so I will not explain it that much here. Feel free to google about it as a refresher. Comment out the earlier code beginning from <code>var markers</code> to <code>map.addLayer(markers)</code> and replace it with the following code chunk.</p>
<pre><code>fetch(url)
    .then((response) =&gt;{
        return response.json()
    })
    .then((data) =&gt; {
        var markers = L.markerClusterGroup();

        var geojsonGroup = L.geoJSON(data, {
            onEachFeature : function(feature, layer){
                layer.bindPopup(`&lt;b&gt;Facility Name:&lt;/b&gt; ${feature.properties.Facility_N} &lt;br&gt;
                &lt;b&gt;Type:&lt;/b&gt; ${feature.properties.Type}`);
            },
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng);
            }
        });

        markers.addLayer(geojsonGroup);
        map.addLayer(markers);

    })
    .catch((error) =&gt; {
        console.log(`This is the error: ${error}`)
    })
</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="cluster-to-reduce-the-clutter.html#cb147-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="fu">rep</span>(<span class="st">&#39;D:/gachuhi/my-leaflet/images/cluster-marker-map-fixed.jpg&#39;</span>))</span></code></pre></div>
<p><img src="../images/cluster-marker-map-fixed.jpg" width="942" /></p>
<p>Now all points have their rightful and respective names.</p>
</div>
<div id="additional-features-of-cluster-marker-plugin" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Additional features of Cluster marker plugin<a href="cluster-to-reduce-the-clutter.html#additional-features-of-cluster-marker-plugin" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The official documentation of the plugin lists many other features that come along with the tool. We can’t go through all of them but let’s summise just one important one: the <code>mouseover</code> event. The same way that Leaflet’s markers can have events triggered on them also applies to the Cluster marker plugin. Below is an example but is not part of our exercise.</p>
<pre><code>// We won&#39;t use this

markers.on(&#39;click&#39;, function (a) {
    console.log(&#39;marker &#39; + a.layer);
});</code></pre>
<p>Let’s demonstrate adding a hover event to our cluster marker map, thanks to this <a href="https://gnisitricks.de/2019/03/Adding-Click-and-Mouseover-Events-simultaneously-to-GeoJson-Markers-on-a-Leaflet-Map/">answer</a>.</p>
<pre><code>/////// Added `mouseover` event

fetch(url)
    .then((response) =&gt;{
        return response.json()
    })
    .then((data) =&gt; {
        var markers = L.markerClusterGroup({chunkedLoading: true}); // Splits the add layers to small intervals to prevent page freezing

        var geojsonGroup = L.geoJSON(data, {
            onEachFeature : function(feature, layer){
                layer.bindPopup(`&lt;b&gt;Facility Name:&lt;/b&gt; ${feature.properties.Facility_N} &lt;br&gt;
                &lt;b&gt;Type:&lt;/b&gt; ${feature.properties.Type}`);
            },
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng).on(&#39;mouseover&#39;, function(){
                    this.bindPopup(`Nearest_Center: ${feature.properties.Nearest_To}`).openPopup(); // Add mouseover event
                });
            }
        });

        markers.addLayer(geojsonGroup);
        map.addLayer(markers);

    })
    .catch((error) =&gt; {
        console.log(`This is the error: ${error}`)
    })
</code></pre>
<p>From the above code, we added the <code>mouseover</code> event to each marker point using the <code>on</code> method. The <code>this</code> keyword in <code>this.bindPopup()</code> ties popups of selected variables to coordinates in the <code>var geojsonGroup</code> variable. We also sped the rendering of our Leaflet map by adding <code>chunkedLoading: true</code> parameter to <code>L.markerCluster()</code> function.</p>
<p>Hovering over each marker point will show a value of the <code>Nearest_To</code> attribute which is an actual town centre in closest proximity to the location shown by the marker.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="cluster-to-reduce-the-clutter.html#cb150-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="fu">rep</span>(<span class="st">&#39;D:/gachuhi/my-leaflet/images/cluster-marker-mouseover.jpg&#39;</span>))</span></code></pre></div>
<p><img src="../images/cluster-marker-mouseover.jpg" width="944" /></p>
<p>The code files used for this chapter are available from <a href="https://github.com/sammigachuhi/my-leaflet-project/tree/main/my-leaflet-code/chapter-10-Cluster_marker_points">here</a>.</p>
</div>
<div id="summary-9" class="section level2 hasAnchor" number="10.5">
<h2><span class="header-section-number">10.5</span> Summary<a href="cluster-to-reduce-the-clutter.html#summary-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Cluster marker points are a neat way of displaying several points. Upon zooming out, the spatially sparsed points coalesce to a single unit displaying a digit standing for the number of markers it holds. Upon zooming in, the points spiderfy, (think of spreading out) to their appropriate locations. Here are the lessons from this chapter.</p>
<ul>
<li><p>Clustering points is at times useful for map neatness. In Leaflet, this is made possible with the <code>Leaflet.markercluster</code> plugin.</p></li>
<li><p>It is possible to customize how the spiderfied marker points will appear. For example, instead of settling for the default styles of individual markers, we used the circle markers to show individual points.</p></li>
<li><p>It is also possible to add events to the spiderfied marker points. When clicked the, spiderfied marker points can show a popup, or trigger any other event as specified in its code block. In this chapter, we bound the popups showing the facility’s name, type and nearest centre to our marker points.</p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="heatmaps.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mobile-friendly-webapps.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/10-Clustering_marker_points.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
